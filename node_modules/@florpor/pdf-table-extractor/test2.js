const assert = require('assert').strict;

const pdfTableExtractor = require('./pdf-table-extractor');

function runTests() {
    const used = process.memoryUsage().heapUsed / 1024 / 1024;
    console.log(`Initial: ${Math.round(used * 100) / 100} MB`);

    const plan1_original_version_tables = [
        [["הוראות התכנית"],[""],["תכנית מס' 251-0825547"],[""],["תוספת אחוזי בנייה כלליים"],["מחוז צפון\nמרחב תכנון מקומי הגליל המזרחי \nסוג תכנית תכנית מפורטת\nאישורים\nניתן לצפות במסמכי התכנית ובהחלטות בעניינה באתר תכנון זמין:\nhttp://mavat.moin.gov.il/MavatPS/Forms/SV3.aspx?ABC"]],
        [["דברי הסבר לתכנית"],["תכנית זו מוסיפה אחוזי בנייה כללים למגרש מספר 17המאשר לפי תכנית תמ\"ל1008 בחלקה מספר 216 גוש \n16607 באדמות טורעאן.\nהתכנית מוספה שטח אחוזי בנייה כללים, מאחר ושטח המגרש הוא גדול בהרבה יחסית לממוצע המגרשים \nבאותה תכנית, המאפשר שמירה על תכנית הבנוי של התכנית תמ\"ל1008, חניון פיתוח וכו'."],["דף ההסבר מהווה רקע לתכנית ואינו חלק ממסמכיה הסטטוטוריים.\n "]],
        [[""],["זיהוי וסיווג התכנית1."],["1.1שם התכנית\nומספר התכנית\nשם התכניתתוספת אחוזי בנייה כלליים\nמספר התכנית251-0825547\n1.2שטח התכנית0.775 דונם\n1.4סיווג התכניתסוג התכניתתכנית מפורטת\nהאם מכילה הוראות \nשל תכנית מפורטת\nלא\nועדת התכנון המוסמכת \nלהפקיד את התכנית\nמחוזית\nלפי סעיף בחוקל''ר \nהיתרים או הרשאותתכנית שמכוחה ניתן להוציא היתרים או הרשאות\nסוג איחוד וחלוקהללא איחוד וחלוקה\nהאם כוללת הוראות \nלענין תכנון תלת מימדי\nכן\n "]],
        [["","","","","","","",""],["מקום התכנית1.5","","","","","","",""],["1.5.1נתונים כללייםמרחב תכנון מקומיהגליל המזרחי\nקואורדינאטה X235398\nקואורדינאטה Y743174\n1.5.2תיאור מקוםרכס טורעאן\nרשויות מקומיות בתכנית והתייחסות לתחום הרשות ,נפה1.5.3\nטורעאן - חלק מתחום הרשות :טורעאן\nיזרעאלנפה\nכתובות שבהן חלה התכנית1.5.4","","","","","","",""],["כניסה","","מספר בית","","רחוב","","","ישוב"],["","","","","דרב אלברג'","","","טורעאן"],["שכונהתמ\"ל טורעאן צפוני- רכס טורעאן\nגושים וחלקות בתכנית1.5.5","","","","","","",""],["מספרי חלקות \nבחלקן","מספרי חלקות \nבשלמותן","","חלק  /כל הגוש ","","סוג גוש","מספר גוש",""],["216","","","חלק","","מוסדר","16607",""],["הכל על-פי הגבולות המסומנים בתשריט בקו הכחול .\n \nגושים ישנים1.5.6\nלא רלוונטי\n \nמגרשים  /תאי שטח מתכניות קודמות שלא נרשמו כחלקות1.5.7\nלא רלוונטי\n \nמרחבי תכנון גובלים בתכנית1.5.8\nלא רלוונטי","","","","","","",""]],
        [["","","","","",""],["יחס בין התכנית לבין תכניות מאושרות קודמות1.6","","","","",""],["","","","","",""],[" תאריך "," מס 'עמוד \nבילקוט \nפרסומים","מספר \nילקוט \nפרסומים","הערה ליחס ","סוג יחס ","מספר תכנית \nמאושרת"],["07/07/2016","8454","7299","תכנית זו משנה רק את \nהמפורט בתכנית זו וכל יתר \nהוראות תכנית תמל/ 1008 \nממשיכות לחול.","שינוי","תמל/ 1008"],[" ","","","","",""]],
        [["","","","","","","","",""],["מסמכי התכנית1.7","","","","","","","",""],["","","","","","","","",""],["נכלל\nבהוראות\n התכנית ","תיאור המסמך","תאריך יצירה "," עורך המסמך","תאריך עריכה","מספר \nעמודים/ \nגליון ","קנה \nמידה","תחולה","סוג המסמך"],["כן","","","עאדל דחלה","","","","מחייב","הוראות התכנית"],["לא","תשריט מצב מוצע","","עאדל דחלה","","1","1:500","מחייב","תשריט מצב מוצע"],["לא","","10/02/2020 11:13","עאדל דחלה","24/12/2019","1","1:250","רקע","מצב מאושר"],["כל מסמכי התכנית מהווים חלק בלתי נפרד ממנה ,משלימים זה את זה ויקראו כמקשה אחת .במקרה של סתירה בין המסמכים המחייבים לבין \nהמנחים יגברו המסמכים המחייבים .במקרה של סתירה בין המסמכים המחייבים לבין עצמם תגברנה ההוראות על התשריטים","","","","","","","",""]],
        [["","","","","","","","","","","","","","","","","","","","","","","","","","",""],["בעלי עניין/ בעלי זכויות בקרקע /עורך התכנית ובעלי מקצוע 1.8","","","","","","","","","","","","","","","","","","","","","","","","","",""],["מגיש התכנית1.8.1","","","","","","","","","","","","","","","","","","","","","","","","","",""],["דוא\"ל","פקס","","טלפון","","","בית","רחוב","","","","","ישוב","","","שם תאגיד ","","","מספר \nרשיון ","","שם","","","","סוג","","מקצוע/ \nתואר"],["adel.dahly\n@gmail.co\nm","04-6412926","","04-6412926","","","","דרב \nאלברג' )1 (","","","","","טורעאן","",""," ","","","","","עמאר נסאר","","","","פרטי","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","הערה למגיש התכנית: ","","","","","",""],["","","","","","","","","","","","","","","","","","","","",") 1( כתובת: טורעאן 1695000 ת.ד. 2335.\nיזם1.8.2","","","","","",""],["דוא\"לפקס","","","","","טלפון","","","","בית","","רחוב","","ישוב","","","שם תאגיד ","","","","מספר \nרשיון ","שםסוג","","","","",""],["adel.dahly@gmail.c\nom\n04-6412926","","","","","04-6412926","","","","","","דרב \nאלברג' )1 (","","טורעאן ","",""," ","","","","","עמאר נסארפרטי","","","","",""],["","","","","","","","","","","","","","","","","","","","",") 1( כתובת: טורעאן 1695000 ת.ד. 2335.\nבעלי עניין בקרקע1.8.3","","","","","",""],["דוא\"לפקס","","","","טלפון","","","","בית","","רחוב","","","","ישוב","","","שם תאגיד ","","","מספר \nרשיון ","","שם  ","תיאורסוג","","",""],["adel.dahly@gmail.c\nom\n04-6412926","","","","04-6412926","","","","","","דרב אלברג' )1( ","","","","טורעאן","","","","","","","","עמאר נסאר","בעלים","","",""],[") 1( כתובת: טורעאן 1695000 ת.ד. 2335.\nעורך התכנית ובעלי מקצוע1.8.4","","","","","","","","","","","","","","","","","","","","","","","","","",""]],
        [["","","","","","","","","","",""],["דוא\"ל","פקס","טלפון","בית","רחוב","ישוב","שם תאגיד ","מספר \nרשיון ","שם","סוג","מקצוע/ \nתואר"],["adel.dahly@g\nmail.com","04-6412926","04-6412926","11","אלשאפעי )1( ","טורעאן","הנדסה \nומדידות - \nדחלה עאדל ","88106","עאדל דחלה","עורך ראשי","מהנדס \nאזרחי - \nתאר שני \nהנדסה \nעירונית"],["adel.dahly@g\nmail.com","04-6412926","04-6412926","11","אלשאפעי )1( ","טורעאן","הנדסה \nומדידות - \nדחלה עאדל ","881","עאדל דחלה","מודד","מודד \nומהנדס"],[") 1( כתובת: טורעאן 1695000 ת.ד. 1995.","","","","","","","","","",""]],
        [[""],["הגדרות בתכנית1.9"],[" \nלא רלוונטי\nכל מונח אשר לא הוגדר בתכנית זו ,תהיה נודעת לו המשמעות הנתונה לו בחוק התכנון והבניה \nהתשכ\"  –  ה1965) להלן  \"החוק ( \"או בתקנות שהותקנו מכוחו ,וזאת בהיעדר כוונה אחרת \nמשתמעת."],["מטרת התכנית ועיקרי הוראותיה2."],[""],["מטרת התכנית2.1"],["הוספת שטחי בנייה כלליים"],["עיקרי הוראות התכנית2.2"],["תוספת שטח בנייה כליים\n "]],
        [["","","",""],["טבלת יעודי קרקע ותאי שטח בתכנית3.","","",""],["","","",""],["טבלת יעודי קרקע ותאי שטח בתכנית3.1","","",""],["","","",""],["תאי שטח","","","יעוד"],["100","","","מגורים א'"],[" ","","",""],["טבלת שטחים3.2","","",""],["","","",""],["מצב מאושר","","",""],["אחוזיםמ\"ריעוד","","",""],["100755מגורים א'","","",""],["100755סה\"כ","","",""],["","","",""],["מצב מוצע","","",""],["אחוזים מחושבמ\"ר מחושביעוד","","",""],["100773.91מגורים א'","","",""],["100773.91סה\"כ","","",""],[" ","","",""]],
        [["",""],["יעודי קרקע ושימושים4.",""],["",""],[" מגורים א'","4.1"],["",""],["שימושים","4.1.1"],["א. מגורים.\nב. חניה, מחסנים.\nג. משרד לבעלי מקצוע חופשי לדייר המבנה/ מסחר קמעונאי.\nד. מעונות יום.",""],["הוראות ","4.1.2"],["הוראות בינוי  \n1 .","א"],["הוראות בינוי  \n1.דגמי הבתים יותאמו לשפוע הטבעי הקיים . יושם דגש לפיתוח \" החזית החמישית \"  הגגות , \nבפיתוח המגרשים . \n2. תותר המרה ממגורים לשטחים מסחר , משרדים ומעונות יום בקומת הקרקע , במגרשים מס' \n29-38 , 72-89. \nיותרו מסחר קמעונאי המשתלב באזורי המגורים ובלבד שלא יהוו מטרד רעש , עשן וריח , בטיחות \nוהיגנייה וכיו''ב . לא יותרו עסקים שעניינם יצור של מוצרי מזון . \n3. השטח המותר להמרה בכל תא שטח לא יעלה על 100 מ\"ר ) עיקרי בכל בניין ( ויהיה חלק \nמסה\"כ השטחים המותרים בתא השטח בטבלת זכויות הבניה .\n4. יינתנו פתרונות כניסה נפרדת וחניה ע\"פ התקן ונגישות לשטחים אלה ולמגורים הצמודים . \n5. המרת השטחים תותר בכפוף לאישור בקשה להיתר בניה כדין .\n6. מחסנים \nתותר בנייה מחסנים פרטיים לדיירים בקומת קרקע ובקומה התת קרקעית בשטח של עד 8 מ\"ר \nלכל יח\"ד בתנאים הבאים : \nא. המחסן יהווה חלק בלתי נפרד מן הבניין .\nב. עיצוב המחסן והחומרים ממנו הוא עשוי ישולבו בחזית הבניין .\nג. תכנית המחסן תוגש כחלק בלתי נפרד מהיתר הבניה .\n7. חניות מקורות לרכב  \nתותר הקמת חניות מקורות לרכב לחזית דרך לפי התנאים כדלקמן :\nחניות הרכב יבנו על הגבול המשותף עם המגרש השכן פרט לתאי שטח פינתיים ומגרשים הגובלים \nעם מגרשים פינתיים, הכל לפי תכנית פיתוח שתאושר ע\"י הועדה המקומית ובאישור מהנדס העיר \n .\nקווי בניין לחניות רכב :\nקדמי : 0.0 'מ \nצדדי : 0.0 מ' לגבול עם מגרש שכן . במקרה והמגרש גובל גם בצד כלשהי , תותר הקמת חניה רק \nבגבול המרוחק ביותר ממפגש הדרכים בלבד .\nכל זוג סככות בין שכנים יתוכנן בעיצוב תואם אחד למשנהו .\n8. מרתפים \nבכל מגרש תותר בניית מרתף . המרתף לא יבלוט מקווי הבניין .\nפני תקרת המרתף לא יעלו יותר מ 0.80 מ' מעל פני ה 0.0 של המבנים ע''פ תכנית פיתוח שתוגש \nבשלב של היתר בניה , לאישור הועדה המקומית , גובהו הפנימי של המרתף לא יעלה על 2.20 . 'מ ","ב"],["",""]],
        [["",""],[" מגורים א'","4.1"],["לא תותר כניסה נפרדת למרתף אלא מתוך הבניין בלבד . ",""],["עיצוב אדריכלי  \n1. גובה המבנה \nגובה הבניין יימדד ממפלס 0.00 של המבנה .\n2. מעטפת הבניין \nחומרי הגמר של המבנים יהיו טיח עמיד צבעוני או אבן . \n3. גגות \nהגגות יכללו פתרונות אדריכליים לשלוב והסתרת דודי וקולטי השמש . \nחומרי הגמר ו/או הציפוי של הגגות השטוחים יהיו מסוג עמיד שנזקק לתחזוקה שוטפת \nמינימלית . \n4. תשתיות \nלא יאושרו מרזבים , צינורות, אינסטלציה, גז וחיווט חיצוניים גלויים על חזיתות המבנים .\nיאותר מקום אשר ישמש למיקום פילרים למערכות התשתית כולל טלפון , חשמל , כבלים וכדומה \n .\nהפילרים יהיו אחידים . \n5. ניקוז \nניקוז כל הגגות ) כולל מחסנים וחניה מקורה ( יעשה לתוך תא השטח בלבד . ","ג"],["תכנית בינוי  \n1. מחסנים \nתותר בניית מחסנים פרטיים לדיירים בקומת קרקע ובקומה התת קרקעית בשטח של 8 מ''ר לכל \nיח''ד בתנאים הבאים . \nא. המחסן יהווה חלק בלתי נפרד מן הבניין , ויוגש כחלק בלתי נפרד מהיתר הבניה .\nב. עיצוב המחסן והחומרים ממנו הוא עשוי ישולבו בחזית הבניין . \n2. מרתפים \nבכל מגרש תותר בניית מרתף . המרתף לא יבלוט מקווי הבניין . \nפני תקרת המרתף לא יעלו יותר מ 0.80 מ' מעל פני ה 0.0 של המבנים ע''פ תכנית פיתוח שתוגש \nלאישור הועדה המקומית , גובהו הפנימי של המרתף לא יעלה על 2.20. 'מ 4.2  ","ד"],[" ",""]],
        [["","","","","","","","","","","","","","","","","","",""],["טבלת זכויות והוראות בניה - מצב מוצע5.","","","","","","","","","","","","","","","","","",""],[" ","","","","","","","","","","","","","","","","","",""],["קו בנין\n)מטר(","","","","מספר קומות","","גובה \nמבנה- \nמעל \nהכניסה \nהקובעת\n)מטר(","מספר \nיח\"ד","אחוזי \nבניה \nכוללים\n(%)","שטחי בניה\n)מ\"ר(","","","","","גודל \nמגרש\n)מ\"ר(","בניין / \nמקום","תאי שטח","שימוש"," יעוד"],["קדמי","אחורי","צידי- \nשמאלי","צידי- \nימני","מתחת \nלכניסה \nהקובעת","מעל \nהכניסה \nהקובעת","","","","סה\"כ \nשטחי \nבניה","מתחת לכניסה \nהקובעת","","מעל הכניסה הקובעת","","גודל \nמגרש \nכללי","","","",""],["","","","","","","","","","","שרות","עיקרי","שרות","עיקרי","","","","",""],["5","5","3","3","1","3","12","3","122.58","950","50","180","150","570","775","רכס \nטורעאן - \nתמ\"ל \n1008","100","מגורים א'","מגורים א'"],["האמור בטבלה זו גובר, במקרה של סתירה, על הוראות כלליות אחרות, בין בהוראות התכנית ובין בתשריט המצב המוצע.\nגם בטבלה עצמה גוברת הוראה מפורטת על הוראה כללית\nשטחי הבניה המפורטים בטבלה שלעיל כוללים את כל שטחי הבניה המירביים בתכנית זו\nהערכים בטבלה מתייחסים לכל תא שטח בנפרד גם אם הוגדר טווח תאי שטח","","","","","","","","","","","","","","","","","",""]],
        [["",""],["הוראות נוספות6.",""],["",""],["סביבה ונוף","6.1"],["פסולת :\nא. תכנית בינוי פיתוח ועיצוב אדריכלי כהגדרתה בסעיף 6.1 א' , תנחה עקרונות לטיפול בפסולת \nבשכונה הכוללת מקום צלהצבת מכלים לצאירת פסולת מעורבת ולמחזור לפי הנחיות הרשות \nהמקומית . \nרעש בעת ההקמה : \nב . בזמן עבודות ההקמה יינקטו אמצעים למניעת פגיעה באיכות האוויר כדוגמת הרחפת אבק . \nג. בזמן עבודות ההקמה יינקטו אמצעים למניעת  מטרדי רעש .",""],["",""],["עתיקות","6.2"],["על-פי חוק העתיקות , התשל''ח  1978 , אם יתגלו בשטח התכנית עתיקות יש להפסיק מיד את \nהעבודות , להודיע על כך לרשות העתיקות ולא להמשיך בעבודות עד לקבלת הודעה אחרת \nמרשות העתיקות .",""],["",""],["חניה","6.3"],["א. מקומות החניה למגורים , למסחר , למבנים / מוסדות ציבור ולפארקים / גנים ציבוריים , \nיהיו בתחום המגרש . \nב. החניה תהיה על פי התקן  התקף בעת מתן היתרי בניה .",""],["",""],["חשמל","6.4"],["",""],["",""],["הוראות פיתוח","6.5"],["1. מפלס מבנים \nמפלס קומת הקרקע במבנים יהיה גבוה ב  10 ס''מ לפחות מרום מכסה שוחת הביוב הקרובה \nביותר למבנה בתא השטח, וב -20 ס''מ לפחות מרום מכסה השוחה הקרובה ביותר למבנה מחוץ \nלתא השטח בשטח הרחוב, לפי השוחה הגבוהה מבין השתיים . \n2. אצירת אשפה  \nכל המתקנים ופחי האשפה יוסתרו בגומחות בגדר המגרש עפ''ר מפרט עיצובי אשר יהווה חלק \nמתכנית פיתוח תא השטח . הגומחות לא יבלטו אל תוך הרחוב, כמו כן אין לסגור גישה \nלמתקנים אלו ע''י שער או בכל צורה אחרת . \n3. גדרות בנויות וקירות תומכים \nכל גדרות הבניין והקירות התומכים שבין תאי השטח ובתחומם , לא על גובה של 4 מ' ממפלס \nהחצר הנמוכה , חריגה תיעשה רק באישור של ועדה מקומית . כל גדרות הבניין וקירות \nהתומכים ייבנו עפ''י מפרט עיצובי המהווה חלק מתכנית הפיתוח . לא יותר גימור בבטון חשוף . \n4. מעקות והגדרות \nכל הגדרות והמעקות בין תאי השטח ובתחומם יבוצעו מחומר קשיח באישור מהנדס העיר . \n5. הקירות הגובליס ברחובות לא יעלו על גובה 2 מטר ממפלס המדרכה הצמודה . \nתותר הקמת מעקה נוסף הדרוש לפי חוק התכנון והבניה מחומרים קליט  ברזל , פריקסטי בטון \nוכו'.",""],["",""],["ניהול מי נגר","6.6"],["בשטחים הפתוחים ישולבו אמצעים להשהיית נגר עילי ותכנונם ייעשה ע''י אדרי' נוף בשיתוף ",""],["",""]],
        [["",""],["ניהול מי נגר","6.6"],["יועץ שימור נגר . בשיפועים גדולים מ  2% יבוצעו סכרונים ו / או טרסות למיתון ושימוש בכיסוי \nצמיחה תואמת אקלים . בכל המגרשים בתכנית יובטח שטח מחלחל בהיקף של 15% משטח \nהמגרש .",""],["",""],["פיתוח תשתית","6.7"],["א. מערכות הביוב יהיו נפרדות לחלוטין ממערכות הניקוז . \nב. איכות השפכים המותרים לחיבור למאסף המרכזי תהיה בהתאם לתקנים הנדרשים ע''י \nהמשרד להגנת הסביבה וברמה שלא תפגע בצנרת ובמתקנים . במידת הצורך , יבוצע טיפול קדם \nבמגרש, טרם החיבור למערכת הביוב העירונית . \nג . כל קווי התשתיות שבתחום התכנית ) למעט מתקנים סלולריים ( , יהיו תת- קרקעיים .",""],["",""],["תנאים למתן היתרי איכלוס","6.8"],["א. תנאי לאכלוס מלא הינו ביצוע בפועל של כלל התכנית על  פי הנחיות רשות התמרור \nהמוסמכת ) חניות , ביצוע מדרכות וכו' ( . \nב. לא יותר אכלוס או שימוש במבנים ובשטחים , אלא אם כן הושלם ביצוע בפועל של מערכת \nהביוב ומתקינה בהתאם לתנאים שנדרשו ע''י המשרד להגנת הסביבה ומשרד הבריאות .",""],["",""],["תנאים למתן היתרי בניה","6.9"],["א. היתרי בנייה יינתנו עפ''י תכנית זו ועפ''י תכנית בינוי , פיתוח ועיצוב אדריכלי , שתתבסס על \nעקרונות הנספחים שצורפו ושתאושר ע''י הועדה המקומית , טרם הוצאת היתרי הבניה . תכנית \nזו תכלול הוראות מפורטות בדבר : \n1. מפלסי קרקע סופיים , חומרי בנין וחומרי גמר , שערים וגדרות קירות תמך , מתקנים לאצירת \nאשפה , פיתוח השטח הציבורי , פרטים אופייניים בקנה מידה מתאים , פירוט גינון ונטיעות , \nריצוף , ריהוט , תאורה , מתקנים הנדסיים , מצללות , מערכות השקיה , פילרים של חשמל , \nתקשורת ומים , ניקוז הגגות , חומרי בניה וכדומה .  \n2. תכנון של מערך כל הדרכים בתוכנית וחיבורן לדרכים הגובלות בתוכנית , לרבות הרחבתן \nולרבות הסדרי התנועה בהן . \n3. תכנון מפורט של החניות ופתרון להעלאה והורדת נוסעים למגרשים הציבוריים . \n4. עבודות התשתית לרבות קו ביוב ו/או קו ניקוז , ו/ או תא ביוב , ו / או דרך , ו / או עמוד \nתאורה , ו / או קווי תאורה , ו / או מרכזיות תאורה וכל העבודות הכרוכות בביצוע הנ''ל . \n5. פתרון פסולת הכולל תנאים למניעת מטרדים סביבתיים . \n6. א . התכנית תכלול התייחסות לבניה ירוקה לרבות העמדת המבנים וכן , מניעת הפרעות רעש \nמשימושים מעוורבים בעלי השפעה אקוסטיזת .",""],["",""],["מגבלות בניה לגובה","6.10"],["הגובה לא יחרוג מ-24 מ' מעל פני השטח אלא באישור של נציג שרהב''ט בועדה מחוזית צפון . \nהאמור כולל בינוי ומתקנים הנדסיים ובכלל זה עגורנים בזמן העבודות .",""],["",""],["ביצוע התכנית7.",""],["",""],["שלבי ביצוע7.1",""],["",""],["מימוש התכנית7.2",""],["",""]],
        [[""],[""],[""],["תכנית תמומש תוך 5 שנים מאושרה"],[" "]]
    ];

    pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    }).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    })).then(() => pdfTableExtractor('/home/mor/dev/tmp/pdf_test/test_plan1.pdf', {maxEdgesPerPage: 1000}).then(res => {
        const tableData = res.pageTables.map(page => page.tables);
        assert.deepEqual(plan1_original_version_tables, tableData);
        console.log('plan1 test success!');

        const used = process.memoryUsage().heapUsed / 1024 / 1024;
        console.log(`Post test ${Math.round(used * 100) / 100} MB`);
    }));

    //let p = Promise.resolve().then(a).then(a).then(a).then(a).then(a);

    /*for (let i=0; i<50; i++) {
        p = p.then(a);
    }*/
}

setTimeout(runTests, 1);
